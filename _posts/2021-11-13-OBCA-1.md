---
layout: post
title: "OBCA学习笔记_I"
subtitle: "单点数据库和分布式数据库的特点"
date: 2021-11-13
background: '/img/posts/06.jpg'
---
# 传统集中式数据库面临的挑战
## 优势  
* **成熟稳定**
* **行业适配性强** 
* **生态完善** 

## 劣势  
* **成本高** （软件&硬件）  
* **无法横向扩容** 只能增加CPU/内存/硬盘，或升级主机；一定能达到单点的上线

------

# 使用数据库中间件进行分库分表
## 优势  
* **线性扩展** 
* **技术成本低** 

## 劣势  
* **跨库分布式业务**   
只能通过中间件，难以做到$RPO = 0$，在遇到异常或故障时无法100%保证分布式事务的ACID能力。  
* **全局一致性**  
多个数据库服务器时间戳不一致，很难保证多个数据库中数据版本号一致。
* **负载均衡**  
扩容或缩容时，底层数据库引擎无法在线调整数据分布规则，因此需要暂停业务重新导入数据。
* **跨库复杂SQL**  
跨库的复杂SQL运算（eg. 多变做分片键无关的关联查询）只能在中间件完成，而中间件不具备分布式并行计算的能力，最终会限制应用对SQL的使用，产生业务侵入性。

-------

# 原生分布式关系型数据库架构
## 优势
* **数据高可靠+服务高可用**
  多副本一致性协议Paxos的工业级实现，个别节点发生故障时数据零丢失（$RPO = 0$）,服务快速恢复（$RTO < 30s$）。
* **线性扩容**
* **低成本**
* **全局一致性**
  支持分布式事务，确保全局一致性，支持分布式复杂查询。
* **灵活的部署方式**
* **对业务透明**
  业务系统可以像使用单点数据库一样使用分布式数据库。  

-----------------

# 传统集中式数据库与以OceanBase为代表的分布式数据库对比

|                            | 传统集中式数据库                                             | 以OceanBase为代表的分布式数据库                              |
| -------------------------- | :----------------------------------------------------------- | ------------------------------------------------------------ |
| **产品架构**               | 经典的“单点集中式”架构，采用“全共享(Share-Everything)”架构。 | 原生的“分布式”数据库，采用Paxos分布式一致性协议。            |
| **数据可靠性和服务可用性** | 利用高端硬件保证数据可靠性。采用“主从复制”，主节点故障的情况下，RPO>0;不能自动恢复服务，RTO需要以小时为单位计算。 | 以普通PC硬件为基础，利用Paxos分布式一致性协议保证数据可靠性。主节点故障，Paxos可以保证RPO=0，RTO<30s，并且组东选举并恢复服务。 |
| **扩展性**                 | 只能纵向扩展，且最终必然会达到单点架构下的容量上限。计算节点通常无法扩展。少数模式下（eg. RAC，pureScale）可做计算节点扩展，但多个计算节点间仍需要访问单点贡献存储，并且可以扩展的节点数量有限。 | 数据节点和计算节点均可以在MPP架构下实现水平扩展。数据节点和计算节点均没有数量限制，在网络带宽足够的前提下，可以扩充至任意数目。 |
| **应用场景**               | 企业客户（金融、电信、政企）的核心系统。                     | 互联网业务，逐渐迈向传统业务。                               |
| **使用成本**               | 比较昂贵（硬件&软件）。                                      | 相对较低。                                                   |


----------------------

# 小结
**传统集中式数据库已经非常成熟。但在大数据时代，依然面临许多挑战，分布式数据库可以有效解决这些问题，是未来数据库发展的重点方向。**
* 传统数据库往往对硬件有较高要求，只能纵向扩展，无法横向扩展，容易达到性能上限。
* 分库分表虽然可以横向扩展，但不支持复杂SQL、难保证分布式业务的ACID等新问题。
* 分布式数据库可以有效解决以上问题，应用可以像使用集中式数据库一样使用分布式数据库，分布式数据库具有**低硬件成本、高可扩展性、高可用性等特性。**
